{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.200.1"},"children":{"MediaProcessingStack":{"id":"MediaProcessingStack","path":"MediaProcessingStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.200.1"},"children":{"MediaProcessingAlarms":{"id":"MediaProcessingAlarms","path":"MediaProcessingStack/MediaProcessingAlarms","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.Topic","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingAlarms/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sns.CfnTopic","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SNS::Topic","aws:cdk:cloudformation:props":{"topicName":"dev-media-processing-alarms"}}}}},"OriginalMediaBucket":{"id":"OriginalMediaBucket","path":"MediaProcessingStack/OriginalMediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"dev-original-media-043309357886","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET","PUT","POST","DELETE"],"allowedOrigins":["*"]}]},"lifecycleConfiguration":{"rules":[{"expirationInDays":90,"status":"Enabled"}]},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/OriginalMediaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"OriginalMediaBucket322A29F3"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MediaProcessingStack/OriginalMediaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.200.1","metadata":[]},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/OriginalMediaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"Notifications":{"id":"Notifications","path":"MediaProcessingStack/OriginalMediaBucket/Notifications","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Notifications/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.200.1"},"children":{"Staging":{"id":"Staging","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"Role":{"id":"Role","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}},"Handler":{"id":"Handler","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"ProcessedMediaBucket":{"id":"ProcessedMediaBucket","path":"MediaProcessingStack/ProcessedMediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ProcessedMediaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"dev-processed-media-043309357886","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET"],"allowedOrigins":["*"]}]},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/ProcessedMediaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ProcessedMediaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"ProcessedMediaBucket446D3976"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MediaProcessingStack/ProcessedMediaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.200.1","metadata":[]},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/ProcessedMediaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}}}},"MediaProcessingDLQ":{"id":"MediaProcessingDLQ","path":"MediaProcessingStack/MediaProcessingDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"dev-media-processing-dlq"}}}}},"MediaProcessingQueue":{"id":"MediaProcessingQueue","path":"MediaProcessingStack/MediaProcessingQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"dev-media-processing-queue","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["MediaProcessingDLQ38BEDAF3","Arn"]},"maxReceiveCount":3},"visibilityTimeout":900}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/MediaProcessingQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Condition":{"ArnLike":{"aws:SourceArn":{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]}}},"Effect":"Allow","Principal":{"Service":"s3.amazonaws.com"},"Resource":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"MediaProcessingQueue56039BA9"}]}}}}}}},"MediaMetadataTable":{"id":"MediaMetadataTable","path":"MediaProcessingStack/MediaMetadataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaMetadataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"mediaId","attributeType":"S"},{"attributeName":"processedAt","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"ProcessedAtIndex","keySchema":[{"attributeName":"processedAt","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"mediaId","keyType":"HASH"}],"tableName":"dev-media-metadata"}}},"ScalingRole":{"id":"ScalingRole","path":"MediaProcessingStack/MediaMetadataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}}}},"SharedLayer":{"id":"SharedLayer","path":"MediaProcessingStack/SharedLayer","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.LayerVersion","version":"2.200.1","metadata":[]},"children":{"Code":{"id":"Code","path":"MediaProcessingStack/SharedLayer/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/SharedLayer/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/SharedLayer/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/SharedLayer/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnLayerVersion","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::LayerVersion","aws:cdk:cloudformation:props":{"compatibleRuntimes":["python3.10"],"content":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"4b929399f5e1fcddf0929b3d54aee1a46685c965646b28cdd45cae5c24bb9c98.zip"},"description":"Shared dependencies for media processing"}}}}},"ImageProcessorFunction":{"id":"ImageProcessorFunction","path":"MediaProcessingStack/ImageProcessorFunction","constructInfo":{"fqn":"@aws-cdk/aws-lambda-python-alpha.PythonFunction","version":"2.200.1-alpha.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetBucket*","s3:GetObject*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},"/*"]]}]},{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},"/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},"/index/*"]]}]},{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","Arn"]}}],"Version":"2012-10-17"},"policyName":"ImageProcessorFunctionServiceRoleDefaultPolicy3F61B55D","roles":[{"Ref":"ImageProcessorFunctionServiceRoleBF4C20FC"}]}}}}}}},"Code":{"id":"Code","path":"MediaProcessingStack/ImageProcessorFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/ImageProcessorFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/ImageProcessorFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"ce37d2664fb5c1a52c0d68be85b396df94d32440ddb305a8b5ac60224409f0c4.zip"},"environment":{"variables":{"ENVIRONMENT":"dev","DYNAMODB_TABLE":{"Ref":"MediaMetadataTable190A6CFD"},"PROCESSED_BUCKET":{"Ref":"ProcessedMediaBucket446D3976"}}},"handler":"image_processor.lambda_handler","layers":[{"Ref":"SharedLayer27DFABF0"}],"loggingConfig":{"logFormat":"JSON"},"memorySize":1024,"role":{"Fn::GetAtt":["ImageProcessorFunctionServiceRoleBF4C20FC","Arn"]},"runtime":"python3.10","timeout":900}}}}},"UploadHandlerFunction":{"id":"UploadHandlerFunction","path":"MediaProcessingStack/UploadHandlerFunction","constructInfo":{"fqn":"@aws-cdk/aws-lambda-python-alpha.PythonFunction","version":"2.200.1-alpha.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"MediaProcessingStack/UploadHandlerFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MediaProcessingStack/UploadHandlerFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/UploadHandlerFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/UploadHandlerFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/UploadHandlerFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},"/*"]]}]},{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","Arn"]}},{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},"/index/*"]]}]}],"Version":"2012-10-17"},"policyName":"UploadHandlerFunctionServiceRoleDefaultPolicyBB324832","roles":[{"Ref":"UploadHandlerFunctionServiceRole483D683C"}]}}}}}}},"Code":{"id":"Code","path":"MediaProcessingStack/UploadHandlerFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/UploadHandlerFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/UploadHandlerFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/UploadHandlerFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"035fe7f13e70b1a148977f7f9534f87882faa2e839c830969f387c0bbc5e4801.zip"},"environment":{"variables":{"ENVIRONMENT":"dev","ORIGINAL_BUCKET":{"Ref":"OriginalMediaBucket322A29F3"},"PROCESSING_QUEUE_URL":{"Ref":"MediaProcessingQueue56039BA9"},"METADATA_TABLE":{"Ref":"MediaMetadataTable190A6CFD"}}},"handler":"upload_handler.lambda_handler","layers":[{"Ref":"SharedLayer27DFABF0"}],"loggingConfig":{"logFormat":"JSON"},"memorySize":256,"role":{"Fn::GetAtt":["UploadHandlerFunctionServiceRole483D683C","Arn"]},"runtime":"python3.10","timeout":30}}}}},"StatusHandlerFunction":{"id":"StatusHandlerFunction","path":"MediaProcessingStack/StatusHandlerFunction","constructInfo":{"fqn":"@aws-cdk/aws-lambda-python-alpha.PythonFunction","version":"2.200.1-alpha.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"MediaProcessingStack/StatusHandlerFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MediaProcessingStack/StatusHandlerFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/StatusHandlerFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/StatusHandlerFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/StatusHandlerFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:ConditionCheckItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:Scan"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},"/index/*"]]}]},{"Action":["s3:GetBucket*","s3:GetObject*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"StatusHandlerFunctionServiceRoleDefaultPolicyE96F8D49","roles":[{"Ref":"StatusHandlerFunctionServiceRole1D3711A3"}]}}}}}}},"Code":{"id":"Code","path":"MediaProcessingStack/StatusHandlerFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/StatusHandlerFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/StatusHandlerFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/StatusHandlerFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"035fe7f13e70b1a148977f7f9534f87882faa2e839c830969f387c0bbc5e4801.zip"},"environment":{"variables":{"ENVIRONMENT":"dev","METADATA_TABLE":{"Ref":"MediaMetadataTable190A6CFD"},"PROCESSED_BUCKET":{"Ref":"ProcessedMediaBucket446D3976"}}},"handler":"status_handler.lambda_handler","layers":[{"Ref":"SharedLayer27DFABF0"}],"loggingConfig":{"logFormat":"JSON"},"memorySize":256,"role":{"Fn::GetAtt":["StatusHandlerFunctionServiceRole1D3711A3","Arn"]},"runtime":"python3.10","timeout":30}}}}},"MediaProcessingApi":{"id":"MediaProcessingApi","path":"MediaProcessingStack/MediaProcessingApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.RestApi","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnRestApi","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::RestApi","aws:cdk:cloudformation:props":{"description":"API for media processing pipeline","name":"dev-media-processing-api"}}},"Deployment":{"id":"Deployment","path":"MediaProcessingStack/MediaProcessingApi/Deployment","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Deployment","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Deployment/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnDeployment","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Deployment","aws:cdk:cloudformation:props":{"description":"API for media processing pipeline","restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}},"DeploymentStage.prod":{"id":"DeploymentStage.prod","path":"MediaProcessingStack/MediaProcessingApi/DeploymentStage.prod","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Stage","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/DeploymentStage.prod/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnStage","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Stage","aws:cdk:cloudformation:props":{"deploymentId":{"Ref":"MediaProcessingApiDeployment45551F9838964887e3d9c73b9931eb139694dc90"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"},"stageName":"prod"}}}}},"Endpoint":{"id":"Endpoint","path":"MediaProcessingStack/MediaProcessingApi/Endpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"Default":{"id":"Default","path":"MediaProcessingStack/MediaProcessingApi/Default","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.ResourceBase","version":"2.200.1","metadata":[]},"children":{"media":{"id":"media","path":"MediaProcessingStack/MediaProcessingApi/Default/media","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Fn::GetAtt":["MediaProcessingApi0A9A6701","RootResourceId"]},"pathPart":"media","restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}},"upload":{"id":"upload","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Ref":"MediaProcessingApimedia6C6E7F08"},"pathPart":"upload","restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}},"POST":{"id":"POST","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/POST","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.200.1","metadata":[]},"children":{"ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload":{"id":"ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/POST/ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["UploadHandlerFunction1DEB4309","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:043309357886:",{"Ref":"MediaProcessingApi0A9A6701"},"/",{"Ref":"MediaProcessingApiDeploymentStageprod81E9BDF6"},"/POST/media/upload"]]}}}},"ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload":{"id":"ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/POST/ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.POST..media.upload","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["UploadHandlerFunction1DEB4309","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:043309357886:",{"Ref":"MediaProcessingApi0A9A6701"},"/test-invoke-stage/POST/media/upload"]]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/POST/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"POST","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["UploadHandlerFunction1DEB4309","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"MediaProcessingApimediaupload7BD2FE45"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}},"OPTIONS":{"id":"OPTIONS","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/upload/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'*'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE'","method.response.header.Access-Control-Max-Age":"'86400'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"MediaProcessingApimediaupload7BD2FE45"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}}}},"{mediaId}":{"id":"{mediaId}","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Ref":"MediaProcessingApimedia6C6E7F08"},"pathPart":"{mediaId}","restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}},"status":{"id":"status","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Resource","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnResource","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Resource","aws:cdk:cloudformation:props":{"parentId":{"Ref":"MediaProcessingApimediamediaId2A708D1A"},"pathPart":"status","restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}},"GET":{"id":"GET","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/GET","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.200.1","metadata":[]},"children":{"ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status":{"id":"ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/GET/ApiPermission.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["StatusHandlerFunction795904D8","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:043309357886:",{"Ref":"MediaProcessingApi0A9A6701"},"/",{"Ref":"MediaProcessingApiDeploymentStageprod81E9BDF6"},"/GET/media/*/status"]]}}}},"ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status":{"id":"ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/GET/ApiPermission.Test.MediaProcessingStackMediaProcessingApi7CA1B650.GET..media.{mediaId}.status","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["StatusHandlerFunction795904D8","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:043309357886:",{"Ref":"MediaProcessingApi0A9A6701"},"/test-invoke-stage/GET/media/*/status"]]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/GET/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"authorizationType":"NONE","httpMethod":"GET","integration":{"type":"AWS_PROXY","uri":{"Fn::Join":["",["arn:aws:apigateway:us-east-1:lambda:path/2015-03-31/functions/",{"Fn::GetAtt":["StatusHandlerFunction795904D8","Arn"]},"/invocations"]]},"integrationHttpMethod":"POST"},"resourceId":{"Ref":"MediaProcessingApimediamediaIdstatusBBADA4E7"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}},"OPTIONS":{"id":"OPTIONS","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/{mediaId}/status/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'*'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE'","method.response.header.Access-Control-Max-Age":"'86400'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"MediaProcessingApimediamediaIdstatusBBADA4E7"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}}}}}},"OPTIONS":{"id":"OPTIONS","path":"MediaProcessingStack/MediaProcessingApi/Default/media/OPTIONS","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.Method","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingApi/Default/media/OPTIONS/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigateway.CfnMethod","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGateway::Method","aws:cdk:cloudformation:props":{"apiKeyRequired":false,"authorizationType":"NONE","httpMethod":"OPTIONS","integration":{"type":"MOCK","requestTemplates":{"application/json":"{ statusCode: 200 }"},"integrationResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":"'*'","method.response.header.Access-Control-Allow-Origin":"'*'","method.response.header.Access-Control-Allow-Methods":"'GET,POST,PUT,DELETE'","method.response.header.Access-Control-Max-Age":"'86400'"}}]},"methodResponses":[{"statusCode":"204","responseParameters":{"method.response.header.Access-Control-Allow-Headers":true,"method.response.header.Access-Control-Allow-Origin":true,"method.response.header.Access-Control-Allow-Methods":true,"method.response.header.Access-Control-Max-Age":true}}],"resourceId":{"Ref":"MediaProcessingApimedia6C6E7F08"},"restApiId":{"Ref":"MediaProcessingApi0A9A6701"}}}}}}}}}}}},"LambdaErrorRateAlarm":{"id":"LambdaErrorRateAlarm","path":"MediaProcessingStack/LambdaErrorRateAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/LambdaErrorRateAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"MediaProcessingAlarms02E7EA9C"}],"alarmDescription":"Alarm when Lambda function has errors","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"FunctionName","value":{"Ref":"ImageProcessorFunction11AF6264"}}],"evaluationPeriods":1,"metricName":"Errors","namespace":"AWS/Lambda","period":300,"statistic":"Sum","threshold":1}}}}},"QueueAgeAlarm":{"id":"QueueAgeAlarm","path":"MediaProcessingStack/QueueAgeAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/QueueAgeAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"MediaProcessingAlarms02E7EA9C"}],"alarmDescription":"Alarm when messages are stuck in queue","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateAgeOfOldestMessage","namespace":"AWS/SQS","period":300,"statistic":"Maximum","threshold":300}}}}},"DLQMessageCountAlarm":{"id":"DLQMessageCountAlarm","path":"MediaProcessingStack/DLQMessageCountAlarm","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Alarm","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/DLQMessageCountAlarm/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnAlarm","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Alarm","aws:cdk:cloudformation:props":{"alarmActions":[{"Ref":"MediaProcessingAlarms02E7EA9C"}],"alarmDescription":"Alarm when messages are sent to DLQ","comparisonOperator":"GreaterThanOrEqualToThreshold","dimensions":[{"name":"QueueName","value":{"Fn::GetAtt":["MediaProcessingDLQ38BEDAF3","QueueName"]}}],"evaluationPeriods":1,"metricName":"ApproximateNumberOfMessagesVisible","namespace":"AWS/SQS","period":300,"statistic":"Sum","threshold":0}}}}},"MediaProcessingDashboard":{"id":"MediaProcessingDashboard","path":"MediaProcessingStack/MediaProcessingDashboard","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.Dashboard","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingDashboard/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudwatch.CfnDashboard","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudWatch::Dashboard","aws:cdk:cloudformation:props":{"dashboardBody":{"Fn::Join":["",["{\"widgets\":[{\"type\":\"text\",\"width\":24,\"height\":1,\"x\":0,\"y\":0,\"properties\":{\"markdown\":\"# Media Processing Pipeline Overview\"}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":0,\"y\":1,\"properties\":{\"view\":\"timeSeries\",\"title\":\"Lambda Function Metrics\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/Lambda\",\"Invocations\",\"FunctionName\",\"",{"Ref":"ImageProcessorFunction11AF6264"},"\",{\"stat\":\"Sum\"}],[\"AWS/Lambda\",\"Errors\",\"FunctionName\",\"",{"Ref":"ImageProcessorFunction11AF6264"},"\",{\"stat\":\"Sum\"}]],\"yAxis\":{}}},{\"type\":\"metric\",\"width\":12,\"height\":6,\"x\":12,\"y\":1,\"properties\":{\"view\":\"timeSeries\",\"title\":\"SQS Queue Metrics\",\"region\":\"",{"Ref":"AWS::Region"},"\",\"metrics\":[[\"AWS/SQS\",\"ApproximateNumberOfMessagesVisible\",\"QueueName\",\"",{"Fn::GetAtt":["MediaProcessingQueue56039BA9","QueueName"]},"\",{\"stat\":\"Sum\"}],[\"AWS/SQS\",\"ApproximateAgeOfOldestMessage\",\"QueueName\",\"",{"Fn::GetAtt":["MediaProcessingQueue56039BA9","QueueName"]},"\",{\"stat\":\"Maximum\"}]],\"yAxis\":{}}},{\"type\":\"alarm\",\"width\":24,\"height\":3,\"x\":0,\"y\":7,\"properties\":{\"title\":\"Alarms\",\"alarms\":[\"",{"Fn::GetAtt":["LambdaErrorRateAlarm35685FAA","Arn"]},"\",\"",{"Fn::GetAtt":["QueueAgeAlarmC3F61350","Arn"]},"\",\"",{"Fn::GetAtt":["DLQMessageCountAlarm53C9BD22","Arn"]},"\"]}}]}"]]},"dashboardName":"dev-media-processing-dashboard"}}}}},"BucketNotificationsHandler050a0587b7544547bf325f094a3db834":{"id":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Role":{"id":"Role","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:PutBucketNotification","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36","roles":[{"Ref":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"}]}}}}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"OriginalBucketName":{"id":"OriginalBucketName","path":"MediaProcessingStack/OriginalBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"ProcessedBucketName":{"id":"ProcessedBucketName","path":"MediaProcessingStack/ProcessedBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"ProcessingQueueURL":{"id":"ProcessingQueueURL","path":"MediaProcessingStack/ProcessingQueueURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"MetadataTableName":{"id":"MetadataTableName","path":"MediaProcessingStack/MetadataTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"ApiEndpoint":{"id":"ApiEndpoint","path":"MediaProcessingStack/ApiEndpoint","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"DashboardURL":{"id":"DashboardURL","path":"MediaProcessingStack/DashboardURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"CDKMetadata":{"id":"CDKMetadata","path":"MediaProcessingStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MediaProcessingStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.200.1"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MediaProcessingStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.200.1"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}