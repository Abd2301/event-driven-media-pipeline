{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.200.1"},"children":{"MediaProcessingStack":{"id":"MediaProcessingStack","path":"MediaProcessingStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.200.1"},"children":{"OriginalMediaBucket":{"id":"OriginalMediaBucket","path":"MediaProcessingStack/OriginalMediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"dev-original-media-043309357886","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET","PUT","POST","DELETE"],"allowedOrigins":["*"]}]},"lifecycleConfiguration":{"rules":[{"expirationInDays":90,"status":"Enabled"}]},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}],"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/OriginalMediaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"OriginalMediaBucket322A29F3"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MediaProcessingStack/OriginalMediaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.200.1","metadata":[]},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/OriginalMediaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"Notifications":{"id":"Notifications","path":"MediaProcessingStack/OriginalMediaBucket/Notifications","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/OriginalMediaBucket/Notifications/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.200.1"},"children":{"Staging":{"id":"Staging","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"Role":{"id":"Role","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}},"Handler":{"id":"Handler","path":"MediaProcessingStack/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"ProcessedMediaBucket":{"id":"ProcessedMediaBucket","path":"MediaProcessingStack/ProcessedMediaBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ProcessedMediaBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketName":"dev-processed-media-043309357886","corsConfiguration":{"corsRules":[{"maxAge":3000,"allowedHeaders":["*"],"allowedMethods":["GET"],"allowedOrigins":["*"]}]},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"}]}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/ProcessedMediaBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ProcessedMediaBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"ProcessedMediaBucket446D3976"},"policyDocument":{"Statement":[{"Action":["s3:DeleteObject*","s3:GetBucket*","s3:List*","s3:PutBucketPolicy"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"MediaProcessingStack/ProcessedMediaBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.200.1","metadata":[]},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/ProcessedMediaBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}}}},"MediaProcessingDLQ":{"id":"MediaProcessingDLQ","path":"MediaProcessingStack/MediaProcessingDLQ","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingDLQ/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"dev-media-processing-dlq"}}}}},"MediaProcessingQueue":{"id":"MediaProcessingQueue","path":"MediaProcessingStack/MediaProcessingQueue","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.Queue","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingQueue/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueue","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::Queue","aws:cdk:cloudformation:props":{"messageRetentionPeriod":1209600,"queueName":"dev-media-processing-queue","redrivePolicy":{"deadLetterTargetArn":{"Fn::GetAtt":["MediaProcessingDLQ38BEDAF3","Arn"]},"maxReceiveCount":3},"visibilityTimeout":900}}},"Policy":{"id":"Policy","path":"MediaProcessingStack/MediaProcessingQueue/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.QueuePolicy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaProcessingQueue/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_sqs.CfnQueuePolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SQS::QueuePolicy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:SendMessage"],"Condition":{"ArnLike":{"aws:SourceArn":{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]}}},"Effect":"Allow","Principal":{"Service":"s3.amazonaws.com"},"Resource":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","Arn"]}}],"Version":"2012-10-17"},"queues":[{"Ref":"MediaProcessingQueue56039BA9"}]}}}}}}},"MediaMetadataTable":{"id":"MediaMetadataTable","path":"MediaProcessingStack/MediaMetadataTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/MediaMetadataTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"mediaId","attributeType":"S"},{"attributeName":"processedAt","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","globalSecondaryIndexes":[{"indexName":"ProcessedAtIndex","keySchema":[{"attributeName":"processedAt","keyType":"HASH"}],"projection":{"projectionType":"ALL"}}],"keySchema":[{"attributeName":"mediaId","keyType":"HASH"}],"tableName":"dev-media-metadata"}}},"ScalingRole":{"id":"ScalingRole","path":"MediaProcessingStack/MediaMetadataTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}}}},"SharedLayer":{"id":"SharedLayer","path":"MediaProcessingStack/SharedLayer","constructInfo":{"fqn":"@aws-cdk/aws-lambda-python-alpha.PythonLayerVersion","version":"2.200.1-alpha.0","metadata":[]},"children":{"Code":{"id":"Code","path":"MediaProcessingStack/SharedLayer/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/SharedLayer/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/SharedLayer/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/SharedLayer/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnLayerVersion","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::LayerVersion","aws:cdk:cloudformation:props":{"compatibleRuntimes":["python3.10"],"content":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"cc6e40b83c38df3ac79d6aecf260c4bd77e32451ec56a4f9689fca9fca696cab.zip"},"description":"Shared dependencies for media processing"}}}}},"ImageProcessorFunction":{"id":"ImageProcessorFunction","path":"MediaProcessingStack/ImageProcessorFunction","constructInfo":{"fqn":"@aws-cdk/aws-lambda-python-alpha.PythonFunction","version":"2.200.1-alpha.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetBucket*","s3:GetObject*","s3:List*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["OriginalMediaBucket322A29F3","Arn"]},"/*"]]}]},{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ProcessedMediaBucket446D3976","Arn"]},"/*"]]}]},{"Action":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:ConditionCheckItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:GetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:PutItem","dynamodb:Query","dynamodb:Scan","dynamodb:UpdateItem"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["MediaMetadataTable190A6CFD","Arn"]},"/index/*"]]}]},{"Action":["sqs:ChangeMessageVisibility","sqs:DeleteMessage","sqs:GetQueueAttributes","sqs:GetQueueUrl","sqs:ReceiveMessage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["MediaProcessingQueue56039BA9","Arn"]}}],"Version":"2012-10-17"},"policyName":"ImageProcessorFunctionServiceRoleDefaultPolicy3F61B55D","roles":[{"Ref":"ImageProcessorFunctionServiceRoleBF4C20FC"}]}}}}}}},"Code":{"id":"Code","path":"MediaProcessingStack/ImageProcessorFunction/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.200.1"},"children":{"Stage":{"id":"Stage","path":"MediaProcessingStack/ImageProcessorFunction/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.200.1"}},"AssetBucket":{"id":"AssetBucket","path":"MediaProcessingStack/ImageProcessorFunction/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.200.1","metadata":[]}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/ImageProcessorFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"architectures":["x86_64"],"code":{"s3Bucket":"cdk-hnb659fds-assets-043309357886-us-east-1","s3Key":"ce37d2664fb5c1a52c0d68be85b396df94d32440ddb305a8b5ac60224409f0c4.zip"},"environment":{"variables":{"ENVIRONMENT":"dev","DYNAMODB_TABLE":{"Ref":"MediaMetadataTable190A6CFD"},"PROCESSED_BUCKET":{"Ref":"ProcessedMediaBucket446D3976"}}},"handler":"image_processor.lambda_handler","layers":[{"Ref":"SharedLayer27DFABF0"}],"memorySize":1024,"role":{"Fn::GetAtt":["ImageProcessorFunctionServiceRoleBF4C20FC","Arn"]},"runtime":"python3.10","timeout":900}}}}},"BucketNotificationsHandler050a0587b7544547bf325f094a3db834":{"id":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Role":{"id":"Role","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.200.1","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.200.1","metadata":[]}},"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.200.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.200.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":"s3:PutBucketNotification","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleDefaultPolicy2CF63D36","roles":[{"Ref":"BucketNotificationsHandler050a0587b7544547bf325f094a3db834RoleB6FB88EC"}]}}}}}}},"Resource":{"id":"Resource","path":"MediaProcessingStack/BucketNotificationsHandler050a0587b7544547bf325f094a3db834/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"OriginalBucketName":{"id":"OriginalBucketName","path":"MediaProcessingStack/OriginalBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"ProcessedBucketName":{"id":"ProcessedBucketName","path":"MediaProcessingStack/ProcessedBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"ProcessingQueueURL":{"id":"ProcessingQueueURL","path":"MediaProcessingStack/ProcessingQueueURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"MetadataTableName":{"id":"MetadataTableName","path":"MediaProcessingStack/MetadataTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.200.1"}},"CDKMetadata":{"id":"CDKMetadata","path":"MediaProcessingStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"MediaProcessingStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.200.1"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"MediaProcessingStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.200.1"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"MediaProcessingStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.200.1"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}